<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xeno Help & Tutorial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for a pure black (AMOLED) aesthetic */
        body {
            background-color: #000000;
            background-image: radial-gradient(circle at 50% 0%, #111111 0%, #000000 60%);
            background-attachment: fixed;
            color: #f3f4f6;
            line-height: 1.6;
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
        }

        .accent-color { color: #ffffff; }

        .fix-card {
            background-color: rgba(13, 13, 13, 0.85);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid #1a1a1a;
            transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
            position: relative; /* Ensure z-index works */
        }

        .fix-card:hover {
            border-color: #4b5563;
            transform: translateY(-4px);
            box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.8);
            z-index: 10;
        }

        /* --- FIX FOR HARD TO CLICK LINKS --- */
        .fix-card a {
            position: relative;
            z-index: 20;
            display: inline-block;
            padding: 2px 4px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        .fix-card a:hover {
            background-color: rgba(255, 255, 255, 0.1);
            text-decoration: none;
        }

        .fix-card.completed {
            border-color: #10b981;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.2);
        }

        .warning-box {
            background-color: rgba(31, 11, 11, 0.9); 
            border: 1px solid #ef4444; 
            color: #fca5a5; 
        }

        .action-button {
            padding: 8px 16px;
            border-radius: 9999px;
            font-weight: 600;
            font-size: 0.875rem;
            transition: background-color 0.2s;
            position: relative;
            z-index: 50; 
        }

        @keyframes green-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .green-pulse {
            animation: green-pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* INTERACTIVE TUTORIAL STYLES */
        .mock-ui-btn {
            transition: all 0.3s ease;
        }
        
        .mock-active-pulse {
            animation: mock-pulse 1.5s infinite;
            color: #fff;
            filter: drop-shadow(0 0 8px rgba(99, 102, 241, 0.8));
            transform: scale(1.2);
        }

        .client-status-pulse {
            animation: status-pulse 1.5s infinite;
        }

        @keyframes mock-pulse {
            0% { transform: scale(1); filter: drop-shadow(0 0 0px rgba(99, 102, 241, 0)); }
            50% { transform: scale(1.2); filter: drop-shadow(0 0 10px rgba(99, 102, 241, 0.8)); }
            100% { transform: scale(1); filter: drop-shadow(0 0 0px rgba(99, 102, 241, 0)); }
        }

        @keyframes status-pulse {
            0% { color: #10b981; filter: drop-shadow(0 0 0px #10b981); }
            50% { color: #86efac; filter: drop-shadow(0 0 10px #10b981); }
            100% { color: #10b981; filter: drop-shadow(0 0 0px #10b981); }
        }

        .step-indicator.active {
            background-color: #4f46e5;
            color: white;
            border-color: #4f46e5;
        }

        /* CHAT BOT STYLES */
        .chat-container {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .chat-hidden {
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
        }
        .chat-visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }
        /* Scrollbar for chat */
        .chat-scroll::-webkit-scrollbar { width: 6px; }
        .chat-scroll::-webkit-scrollbar-track { background: #111; }
        .chat-scroll::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        .chat-scroll::-webkit-scrollbar-thumb:hover { background: #555; }

        /* IMAGE PREVIEW STYLES */
        .image-preview-container {
            position: relative;
            display: inline-block;
            margin-bottom: 8px;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #374151;
            display: none; /* Hidden by default */
        }
        .image-preview-container img {
            max-height: 80px;
            width: auto;
            display: block;
        }
        .remove-image-btn {
            position: absolute;
            top: 2px;
            right: 2px;
            background: rgba(0,0,0,0.7);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
        }
        .remove-image-btn:hover {
            background: rgba(220, 38, 38, 0.9);
        }
    </style>
</head>
<body class="p-4 md:p-10 min-h-screen">

    <div class="max-w-7xl mx-auto">
        
        <div class="flex flex-col md:flex-row justify-end space-y-3 md:space-y-0 md:space-x-4 mb-8">
            <a href="https://discord.gg/xe-no" target="_blank" rel="noopener noreferrer" class="action-button bg-indigo-600 hover:bg-indigo-700 text-white flex items-center justify-center md:justify-start">
                <!-- Discord Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 127.14 96.36" fill="currentColor" class="mr-2">
                    <path d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.11,77.11,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22c1.24-23.28-3.28-47.54-18.9-72.15ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5.18-12.74,11.54-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"/>
                </svg>
                Discord
            </a>
            <a href="https://xeno.onl" target="_blank" rel="noopener noreferrer" class="action-button bg-blue-600 hover:bg-blue-700 text-white flex items-center justify-center md:justify-start">
                <!-- Globe Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                Website
            </a>
        </div>
        
        <header class="text-center mb-10 py-12">
            <h1 class="text-5xl md:text-7xl font-bold mb-4 tracking-tight text-white">
                Help & Tutorial
            </h1>
            <p class="text-gray-400 text-lg font-light">
                Learn how to use Xeno and troubleshoot common issues
            </p>
        </header>

        <!-- === INTERACTIVE XENO REPLICA === -->
        <div class="mb-16 max-w-5xl mx-auto">
            <div class="flex items-center justify-center mb-6">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#f3f4f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-3"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                <h2 class="text-2xl font-semibold text-white">Interactive Walkthrough</h2>
            </div>

            <div class="fix-card rounded-2xl border border-gray-800 bg-[#050505] overflow-hidden flex flex-col md:flex-row shadow-2xl">
                
                <!-- Left: Controls & Text -->
                <div class="p-8 md:w-1/3 flex flex-col justify-center border-r border-gray-800 bg-[#0a0a0a]">
                    <div class="space-y-6">
                        <!-- Step Indicators -->
                        <div class="flex space-x-2 mb-4">
                            <button onclick="setTutorialStep(1)" id="step-btn-1" class="step-indicator active w-8 h-8 rounded-full border border-gray-600 flex items-center justify-center text-xs font-bold transition-all">1</button>
                            <div class="w-8 h-px bg-gray-700 self-center"></div>
                            <button onclick="setTutorialStep(2)" id="step-btn-2" class="step-indicator w-8 h-8 rounded-full border border-gray-600 flex items-center justify-center text-xs font-bold text-gray-500 transition-all">2</button>
                            <div class="w-8 h-px bg-gray-700 self-center"></div>
                            <button onclick="setTutorialStep(3)" id="step-btn-3" class="step-indicator w-8 h-8 rounded-full border border-gray-600 flex items-center justify-center text-xs font-bold text-gray-500 transition-all">3</button>
                        </div>

                        <div id="tutorial-text-1" class="tutorial-text">
                            <h3 class="text-xl font-bold text-white mb-2">1. Launch Game</h3>
                            <p class="text-gray-400 text-sm">First, open Roblox and join your game. Then, open Xeno.</p>
                            <p class="text-gray-500 text-xs mt-2 italic">Ensure antivirus is off if it doesn't open.</p>
                        </div>
                        <div id="tutorial-text-2" class="tutorial-text hidden">
                            <h3 class="text-xl font-bold text-indigo-400 mb-2">2. Attach (Inject)</h3>
                            <p class="text-gray-400 text-sm">Click the <b class="text-white">Chain Icon</b> at the bottom.</p>
                            <p class="text-gray-500 text-xs mt-2 italic">This connects Xeno to the game process.</p>
                        </div>
                        <div id="tutorial-text-3" class="tutorial-text hidden">
                            <h3 class="text-xl font-bold text-green-400 mb-2">3. Check & Execute</h3>
                            <p class="text-gray-400 text-sm">Wait for the <b class="text-white">Monitor Icon</b> to turn green.</p>
                            <p class="text-gray-400 text-sm mt-2">Then paste your script and click the <b class="text-white">Send Plane</b>.</p>
                        </div>

                        <button onclick="nextStep()" class="mt-4 px-6 py-2 bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-semibold rounded-lg shadow-lg shadow-indigo-500/20 transition-all w-full md:w-auto">
                            Next Step &rarr;
                        </button>
                    </div>
                </div>

                <!-- Right: Exact Mock Xeno Interface -->
                <div class="p-6 md:w-2/3 bg-[#000] relative flex items-center justify-center bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-indigo-900/10 via-black to-black">
                    
                    <!-- Xeno Window Replica -->
                    <div class="w-full max-w-lg bg-[#000000] border border-[#222] shadow-2xl overflow-hidden relative flex flex-col" style="font-family: 'Consolas', 'Monaco', monospace;">
                        
                        <!-- Top Bar -->
                        <div class="h-9 bg-[#050505] flex items-center justify-between px-2 select-none">
                            <div class="flex items-center space-x-2">
                                <!-- Planet Icon -->
                                <svg class="w-5 h-5 text-gray-200" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.54 15H17a5 5 0 0 0-5 5v4.54"/><path d="M7 3.34V5a3 3 0 0 0 3 3a2 2 0 0 1 2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2c0-1.1.9-2 2-2h3.17"/><path d="M11 21.95V18a2 2 0 0 0-2-2a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05"/></svg>
                                <span class="text-[11px] text-gray-300 font-normal tracking-wide">Xeno v1.2.40 https://xeno.onl</span>
                            </div>
                            <!-- Window Controls -->
                            <div class="flex space-x-4 text-gray-500 pr-1">
                                <div class="hover:text-white cursor-pointer">&minus;</div>
                                <div class="hover:text-white cursor-pointer">&#9633;</div>
                                <div class="hover:text-red-500 cursor-pointer text-lg leading-none">&times;</div>
                            </div>
                        </div>

                        <!-- Tabs Bar -->
                        <div class="h-8 bg-[#000000] flex items-end px-2 space-x-0.5 border-b border-[#111]">
                            <div class="px-4 py-1.5 bg-[#000000] text-[10px] text-gray-300 border-t-2 border-white cursor-pointer">Tab 1</div>
                            <div class="px-4 py-1.5 bg-[#000000] text-[10px] text-gray-500 hover:text-gray-300 cursor-pointer">Tab 2</div>
                            <div class="px-4 py-1.5 bg-[#000000] text-[10px] text-gray-500 hover:text-gray-300 cursor-pointer">Tab 3</div>
                            <div class="px-4 py-1.5 bg-[#000000] text-[10px] text-gray-500 hover:text-gray-300 cursor-pointer">Tab 4</div>
                            <div class="px-4 py-1.5 bg-[#000000] text-[10px] text-green-500 font-bold cursor-pointer">Tab 9</div>
                            <div class="px-2 py-1.5 text-gray-400 hover:text-white cursor-pointer">+</div>
                        </div>

                        <!-- Editor Area -->
                        <div class="h-56 bg-[#050505] p-2 text-xs text-gray-400 relative flex">
                            <!-- Line Numbers -->
                            <div class="w-8 text-right pr-3 text-gray-600 select-none border-r border-[#1a1a1a]">
                                1
                            </div>
                            <!-- Code -->
                            <div class="pl-3 w-full font-mono">
                                <span class="text-white">|</span>
                            </div>
                        </div>

                        <!-- Bottom Bar -->
                        <div class="h-10 bg-[#000000] flex items-center justify-between px-3 pb-1">
                            <!-- Left Tools -->
                            <div class="flex space-x-3 text-gray-500">
                                <!-- Settings (Gear) -->
                                <svg class="w-5 h-5 hover:text-white cursor-pointer" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1.29 1.52 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                                <!-- Folder -->
                                <svg class="w-5 h-5 hover:text-white cursor-pointer" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
                                <!-- Save -->
                                <svg class="w-5 h-5 hover:text-white cursor-pointer" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                                <!-- Eraser/Clear -->
                                <svg class="w-5 h-5 hover:text-white cursor-pointer" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21H4a2 2 0 0 1-2-2v-5c0-1.1.9-2 2-2h12a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2Z"></path><line x1="8" y1="21" x2="8" y2="12"></line><line x1="16" y1="21" x2="16" y2="12"></line></svg>
                            </div>

                            <!-- Right Actions (Interactive) -->
                            <div class="flex space-x-3 text-gray-500 items-center">
                                <!-- ATTACH (Chain) -->
                                <button id="mock-attach-btn" class="mock-ui-btn hover:text-white p-1" title="Attach">
                                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
                                </button>
                                
                                <!-- Scripts (List) -->
                                <button class="mock-ui-btn hover:text-white p-1" title="Script Hub">
                                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                                </button>

                                <!-- Clients (Monitor) -->
                                <button id="mock-clients-btn" class="mock-ui-btn hover:text-white p-1" title="Clients Status">
                                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
                                </button>

                                <!-- EXECUTE (Send Plane) -->
                                <button id="mock-exec-btn" class="mock-ui-btn hover:text-white p-1" title="Execute">
                                    <svg class="w-5 h-5 transform rotate-90" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                                </button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <!-- === END INTERACTIVE INTERFACE === -->

        <div class="flex items-center justify-center mb-10">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#f3f4f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-3"><path d="M9.09 3a9 9 0 0 1 5.86 1.13c1.78.68 3.1 2.2 3.55 4.02.45 1.82 0 3.82-1.3 5.12l-5.6 5.6c-1.3 1.3-3.05 1.84-4.87 1.39-1.82-.45-3.34-1.77-4.02-3.55A9 9 0 0 1 3 14.91"/></svg>
            <h2 class="text-2xl font-semibold text-white">Common Issues</h2>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16" id="fixes-grid">

            <div id="fix-1" class="fix-card p-6 rounded-lg flex flex-col justify-between">
                <div>
                    <div class="flex items-start mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#f3f4f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 mt-1 mr-3 text-white"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                        <div>
                            <h2 class="text-xl font-bold accent-color mb-1">Xeno not opening</h2> 
                            <p class="text-sm text-gray-400">You do not have the required dependencies downloaded.</p>
                        </div>
                    </div>
                    
                    <p class="text-gray-300 mb-4">Download Microsoft Webview2 and .NET Runtime 8.0.0</p>
                    <ul class="space-y-3 text-gray-400 list-disc list-inside pl-3">
                        <li class="flex flex-wrap items-center group">
                            <a href="https://go.microsoft.com/fwlink/?linkid=2124701" target="_blank" rel="noopener noreferrer" class="font-medium text-blue-400 hover:text-blue-300 ml-2">Microsoft Webview2</a>
                        </li>
                        <li class="flex flex-wrap items-center group">
                            <a href="https://dotnet.microsoft.com/en-us/download/dotnet/thank-you/runtime-desktop-8.0.10-windows-x64-installer" target="_blank" rel="noopener noreferrer" class="font-medium text-blue-400 hover:text-blue-300 ml-2">.NET Runtime 8.0.0</a>
                        </li>
                    </ul>
                </div>
                
                <div class="mt-6 pt-4 border-t border-gray-800 flex justify-end items-center" id="tracker-fix-1">
                    <button onclick="toggleFixStatus('fix-1')" class="px-5 py-2 text-sm rounded-full transition duration-200 font-semibold mark-button">
                        Mark as Fixed
                    </button>
                </div>
            </div>

            <div id="fix-2" class="fix-card p-6 rounded-lg flex flex-col justify-between">
                <div>
                    <div class="flex items-center mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-3"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="M15 9l-4 4-2-2"/></svg>
                        <h2 class="text-xl font-bold accent-color">"Failed to Attach" Error</h2>
                    </div>
                    <p class="text-gray-400 mb-4">Security software interference or missing C++ dependencies.</p>
                    
                    <ul class="list-disc list-inside space-y-3 pl-3 text-gray-300">
                        <li class="flex flex-wrap items-center group">
                            <span>Install <b><a href="https://aka.ms/vs/17/release/vc_redist.x64.exe" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:text-blue-300 underline">Visual C++ Redist. (x64)</a></b></span>
                        </li>
                        <li class="text-gray-400 font-bold">
                            Add the Xeno folder to your antivirus exclusions.
                        </li>
                        <li>
                            Ensure both Xeno and Roblox are fully closed before running Xeno.
                        </li>
                    </ul>
                </div>
                
                <div class="mt-6 pt-4 border-t border-gray-800 flex justify-end items-center" id="tracker-fix-2">
                    <button onclick="toggleFixStatus('fix-2')" class="px-5 py-2 text-sm rounded-full transition duration-200 font-semibold mark-button">
                        Mark as Fixed
                    </button>
                </div>
            </div>

            <div id="fix-3" class="fix-card p-6 rounded-lg flex flex-col justify-between">
                <div>
                    <div class="flex items-center mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-3"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                        <h2 class="text-xl font-bold accent-color">Version Mismatch / Crash</h2>
                    </div>
                    <p class="text-gray-400 mb-4">Roblox recently updated. Xeno requires specific client versions.</p>
                    
                    <ul class="list-disc list-inside space-y-3 pl-3 text-gray-300">
                        <li class="flex flex-wrap items-center group">
                            <span class="mr-2">Download: <b><a href="https://rdd.weao.gg" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:text-blue-300 underline">Roblox Downgrader</a></b></span>
                        </li>
                        <li>
                            Run the utility to install the <b>last compatible version</b>.
                        </li>
                        <li class="font-semibold">
                            Launch the downgraded Robloxplayerbeta.exe via the folder you installed.
                        </li>
                    </ul>
                </div>
                
                <div class="mt-6 pt-4 border-t border-gray-800 flex justify-end items-center" id="tracker-fix-3">
                    <button onclick="toggleFixStatus('fix-3')" class="px-5 py-2 text-sm rounded-full transition duration-200 font-semibold mark-button">
                        Mark as Fixed
                    </button>
                </div>
            </div>
            
            <div id="fix-4" class="fix-card p-6 rounded-lg flex flex-col justify-between">
                <div>
                    <div class="flex items-center mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#8b5cf6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-3"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
                        <h2 class="text-xl font-bold accent-color">Corrupted Cache Error</h2>
                    </div>
                    <p class="text-gray-400 mb-4">"Error Parsing Clients JSON" or corrupted installation.</p>
                    
                    <ul class="list-disc list-inside space-y-3 pl-3 text-gray-300 text-sm">
                        <li>
                            Press <b>Win + R</b> on your keyboard.
                        </li>
                        <li class="group flex flex-wrap items-center">
                            <span>Type <code class="bg-gray-800 px-1 py-0.5 rounded text-indigo-300">%localappdata%/xeno</code></span>
                            <button onclick="copyToClipboard('%localappdata%/xeno', this)" class="ml-2 inline-flex items-center p-1 rounded hover:bg-white/10 text-gray-500 hover:text-white" title="Copy Path"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button>
                        </li>
                        <li class="font-bold text-red-400">
                            Delete the entire "Xeno" folder.
                        </li>
                        <li>
                            Reinstall Xeno from scratch.
                        </li>
                    </ul>
                </div>
                
                <div class="mt-6 pt-4 border-t border-gray-800 flex justify-end items-center" id="tracker-fix-4">
                    <button onclick="toggleFixStatus('fix-4')" class="px-5 py-2 text-sm rounded-full transition duration-200 font-semibold mark-button">
                        Mark as Fixed
                    </button>
                </div>
            </div>

            <div id="fix-5" class="fix-card p-6 rounded-lg flex flex-col justify-between">
                <div>
                    <div class="flex items-center mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-3"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                        <h2 class="text-xl font-bold accent-color">Official Site Blocked</h2>
                    </div>
                    <p class="text-gray-400 mb-4">If you cannot reach the main download source due to ISP blocks.</p>
                    
                    <ul class="list-disc list-inside space-y-3 pl-3 text-gray-300">
                        <li class="flex flex-wrap items-center group">
                            <span class="mr-2"><b>Mirror:</b> <a href="https://x3no.pages.dev" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:text-blue-300 underline">x3no.pages.dev</a></span>
                        </li>
                        <li class="flex flex-wrap items-center group">
                            <span class="mr-2"><b>Web Proxy:</b> <a href="https://www.proxyium.com/" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:text-blue-300 underline">Proxyium</a></span>
                        </li>
                    </ul>
                </div>
                
                <div class="mt-6 pt-4 border-t border-gray-800 flex justify-end items-center" id="tracker-fix-5">
                    <button onclick="toggleFixStatus('fix-5')" class="px-5 py-2 text-sm rounded-full transition duration-200 font-semibold mark-button">
                        Mark as Fixed
                    </button>
                </div>
            </div>
            
            <div id="fix-6" class="fix-card p-6 rounded-lg flex flex-col justify-between">
                <div>
                    <div class="flex items-center mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#f43f5e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-3"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/><line x1="14" y1="4" x2="10" y2="20"/></svg>
                        <h2 class="text-xl font-bold accent-color">Need Scripts?</h2>
                    </div>
                    <p class="text-gray-400 mb-4">Finding reliable and current scripts for your game session.</p>
                    
                    <ul class="list-disc list-inside space-y-3 pl-3 text-gray-300">
                        <li class="flex flex-wrap items-center group">
                            <span class="mr-2">Visit <b><a href="https://scriptblox.com" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:text-blue-300 underline">ScriptBlox</a></b> for scripts.</span>
                        </li>
                    </ul>
                </div>
                
                <div class="mt-6 pt-4 border-t border-gray-800 flex justify-end items-center" id="tracker-fix-6">
                    <button onclick="toggleFixStatus('fix-6')" class="px-5 py-2 text-sm rounded-full transition duration-200 font-semibold mark-button">
                        Mark as Fixed
                    </button>
                </div>
            </div>

            <div id="fix-7" class="fix-card p-6 rounded-lg flex flex-col justify-between">
                <div>
                    <div class="flex items-center mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#0ea5e9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-3"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>
                        <h2 class="text-xl font-bold accent-color">Tabs saying "null"</h2>
                    </div>
                    <p class="text-gray-400 mb-4">Your tab configuration files have become corrupt.</p>
                    
                    <ul class="list-disc list-inside space-y-3 pl-3 text-gray-300 text-sm">
                        <li>
                            Press <b>Win + R</b> to open Run.
                        </li>
                        <li class="group flex flex-wrap items-center">
                            <span>Type: <code class="bg-gray-800 px-1 py-0.5 rounded text-indigo-300">%localappdata%/xeno/tabs</code></span>
                            <button onclick="copyToClipboard('%localappdata%/xeno/tabs', this)" class="ml-2 inline-flex items-center p-1 rounded hover:bg-white/10 text-gray-500 hover:text-white" title="Copy Path"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button>
                        </li>
                        <li class="font-bold text-red-400">
                            Delete everything inside this folder.
                        </li>
                        <li>
                            Restart Xeno.
                        </li>
                    </ul>
                </div>
                
                <div class="mt-6 pt-4 border-t border-gray-800 flex justify-end items-center" id="tracker-fix-7">
                    <button onclick="toggleFixStatus('fix-7')" class="px-5 py-2 text-sm rounded-full transition duration-200 font-semibold mark-button">
                        Mark as Fixed
                    </button>
                </div>
            </div>

        </div>

        <div class="warning-box p-6 rounded-lg shadow-lg mt-8">
            <h2 class="text-2xl font-bold mb-3 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-3"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                General Info: Antivirus Warnings
            </h2>
            <ul class="list-disc space-y-2 pl-6 text-gray-300">
                <li>
                    Exploits are frequently <b>falsely marked as viruses/malware</b> by antivirus software due to their nature (Obfuscation, game manipulation).
                </li>
                <li>
                    You must <b>temporarily disable your anti-virus/firewall</b> to download and run the file.
                </li>
            </ul>
        </div>
        <footer class="text-center mt-16 pt-6 border-t border-gray-800 text-gray-500 text-sm">
            <p class="mb-2">Guide powered by Xeno community knowledge.</p>
            <p>
                Need more help? Join our Discord: 
                <a href="https://discord.gg/xe-no" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:text-blue-300 font-semibold underline">.gg/xe-no</a>
            </p>
        </footer>

    </div>

<div id="ai-widget" class="fixed bottom-6 right-6 z-50 flex flex-col items-end font-sans">
    
    <div id="chat-window" class="chat-hidden mb-4 w-80 md:w-96 bg-gray-900 border border-gray-700 rounded-2xl shadow-2xl flex flex-col overflow-hidden transition-all duration-300 origin-bottom-right" style="height: 500px; max-height: 80vh;">
        
        <div class="bg-gray-800/95 backdrop-blur-md p-4 border-b border-gray-700 flex justify-between items-center flex-shrink-0">
            <div class="flex items-center">
                <div class="relative">
                    <div class="w-2.5 h-2.5 rounded-full bg-emerald-500 animate-pulse"></div>
                    <div class="absolute top-0 left-0 w-2.5 h-2.5 rounded-full bg-emerald-500 animate-ping opacity-75"></div>
                </div>
                <div class="ml-3">
                    <h3 class="font-bold text-white text-sm tracking-wide">Xeno AI Support</h3>
                    <p class="text-[10px] text-gray-400 uppercase tracking-wider">Automated Assistant</p>
                </div>
            </div>
            <button onclick="toggleChat()" class="text-gray-400 hover:text-white transition-colors p-1 hover:bg-white/10 rounded-md">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
        </div>

        <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4 bg-black/40 scroll-smooth custom-scrollbar">
            <div class="flex justify-start animate-fade-in-up">
                <div class="bg-gray-800 text-gray-200 rounded-2xl rounded-tl-none px-4 py-3 text-sm max-w-[85%] border border-gray-700 shadow-sm leading-relaxed">
                    <p class="font-semibold text-white mb-1">Hello! üëã</p>
                    <p>I have been trained on the Xeno documentation. Ask me about:</p>
                    <ul class="list-disc list-inside mt-2 space-y-1 text-gray-400 text-xs">
                        <li>Installation & Dependencies</li>
                        <li>"Failed to Attach" errors</li>
                        <li>Crashes or Version issues</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="p-3 bg-gray-800 border-t border-gray-700 flex-shrink-0 flex flex-col">
            
            <!-- New: Image Preview Area -->
            <div id="image-preview" class="image-preview-container self-start ml-2">
                <img id="preview-img-elem" src="" alt="Preview">
                <div class="remove-image-btn" onclick="clearImage()">√ó</div>
            </div>
        
            <!-- New: Controls Bar (Model Select) -->
            <div class="flex justify-between items-center mb-2 px-1">
                <select id="model-selector" class="bg-gray-900 text-xs text-gray-400 border border-gray-700 rounded px-2 py-1 focus:outline-none focus:border-indigo-500">
                    <option value="gemini">‚ö° Fast + Vision (Gemini 2.0)</option>
                    <option value="chimera">üß† Deep Logic (Chimera R1)</option>
                </select>
                <span class="text-[10px] text-gray-600">v1.0 Connected</span>
            </div>
        
            <!-- Input Bar -->
            <div class="flex items-center gap-2 bg-gray-900 border border-gray-600 rounded-2xl px-4 py-2 focus-within:border-indigo-500 focus-within:ring-1 focus-within:ring-indigo-500 transition-all">
                
                <!-- Attachment Button -->
                <button onclick="document.getElementById('file-upload').click()" class="text-gray-400 hover:text-white transition-colors" title="Upload Image">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
                </button>
                <!-- Hidden File Input -->
                <input type="file" id="file-upload" accept="image/*" class="hidden" onchange="handleImageSelect(this)">
        
                <input type="text" id="chat-input" autocomplete="off" placeholder="Type your issue..." class="flex-1 bg-transparent border-none text-white text-sm focus:outline-none placeholder-gray-500" onkeydown="handleEnter(event)">
                
                <button onclick="sendMessage()" class="text-indigo-500 hover:text-white transition-colors p-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></polygon></svg>
                </button>
            </div>
        </div>
    </div>
    
    <button onclick="toggleChat()" class="group bg-indigo-600 hover:bg-indigo-500 text-white p-4 rounded-full shadow-[0_0_20px_rgba(79,70,229,0.3)] transition-all hover:scale-105 flex items-center justify-center relative z-50">
        <span class="absolute top-0 right-0 -mt-1 -mr-1 flex h-3 w-3">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
            <span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span>
        </span>
        
        <svg id="icon-open" class="transition-transform duration-300 group-hover:-rotate-12" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
        <svg id="icon-close" class="hidden transition-transform duration-300 group-hover:rotate-90" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
    </button>
</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<!-- INTERACTIVE TUTORIAL LOGIC -->
<script>
    let currentTutorialStep = 1;

    function setTutorialStep(step) {
        currentTutorialStep = step;
        
        // Update Buttons
        document.querySelectorAll('.step-indicator').forEach((btn, idx) => {
            if(idx + 1 === step) {
                btn.classList.add('active');
                btn.classList.remove('text-gray-500');
            } else {
                btn.classList.remove('active');
                btn.classList.add('text-gray-500');
            }
        });

        // Update Text
        document.querySelectorAll('.tutorial-text').forEach(el => el.classList.add('hidden'));
        document.getElementById(`tutorial-text-${step}`).classList.remove('hidden');

        // Handle Visuals on Mock UI
        const attachBtn = document.getElementById('mock-attach-btn');
        const execBtn = document.getElementById('mock-exec-btn');
        const clientsBtn = document.getElementById('mock-clients-btn');

        // Reset Styles
        attachBtn.classList.remove('mock-active-pulse', 'text-indigo-400');
        execBtn.classList.remove('mock-active-pulse', 'text-green-400');
        clientsBtn.classList.remove('client-status-pulse', 'text-green-400');
        
        // Logic
        if(step === 1) {
            // Step 1: Just Launch (Reset everything)
            // No visual changes needed
        } 
        else if (step === 2) {
            // Step 2: Attach (Chain Icon)
            attachBtn.classList.add('mock-active-pulse', 'text-indigo-400');
        } 
        else if (step === 3) {
            // Step 3: Check & Execute (Client turns green, Send highlighted)
            clientsBtn.classList.add('client-status-pulse', 'text-green-400');
            execBtn.classList.add('mock-active-pulse', 'text-green-400');
        }
    }

    function nextStep() {
        if(currentTutorialStep < 3) {
            setTutorialStep(currentTutorialStep + 1);
        } else {
            setTutorialStep(1); // Loop back
        }
    }
</script>

<script>
    // ------------------------------------------------------------------
    // 1. SYSTEM PROMPT & CONTEXT LOADER
    // ------------------------------------------------------------------
    
    // Default System Instruction
    const conversationHistory = [
        { 
            role: "system", 
            content: "You are Xeno AI Support. You help with installation, crashes, and attachments. If you don't know the answer, refer the user to Discord." 
        }
    ];

    // --- FUNCTION TO LOAD CONTEXT.MD ---
    async function loadContext() {
        try {
            // This fetches the file from your website root
            const response = await fetch('context.md');
            
            if (!response.ok) throw new Error("Context file not found");
            
            const markdownText = await response.text();
            
            // Append the file content to the system prompt
            conversationHistory[0].content = `
                You are Xeno AI Support. 
                Use the following KNOWLEDGE BASE to answer the user's questions. 
                If the answer is not in the knowledge base, suggest joining the Discord.
                
                --- START KNOWLEDGE BASE ---
                ${markdownText}
                --- END KNOWLEDGE BASE ---
            `;
            
            console.log("‚úÖ AI Context Loaded Successfully from context.md");
            
        } catch (error) {
            console.error("‚ö†Ô∏è Could not load context.md:", error);
        }
    }

    // Load the context immediately when page opens
    loadContext();

    // ------------------------------------------------------------------
    // 2. UI & CHAT LOGIC
    // ------------------------------------------------------------------

    let isChatOpen = false;
    const chatWindow = document.getElementById('chat-window');
    const iconOpen = document.getElementById('icon-open');
    const iconClose = document.getElementById('icon-close');
    const chatInput = document.getElementById('chat-input');
    const messagesContainer = document.getElementById('chat-messages');

    function toggleChat() {
        isChatOpen = !isChatOpen;
        if (isChatOpen) {
            chatWindow.classList.remove('chat-hidden');
            chatWindow.classList.add('chat-visible');
            iconOpen.classList.add('hidden');
            iconClose.classList.remove('hidden');
            setTimeout(() => chatInput.focus(), 100);
        } else {
            chatWindow.classList.remove('chat-visible');
            chatWindow.classList.add('chat-hidden');
            iconOpen.classList.remove('hidden');
            iconClose.classList.add('hidden');
        }
    }

    function handleEnter(e) {
        if (e.key === 'Enter') sendMessage();
    }

    // ============================================
    // NEW LOGIC: Image Handling & Dual Models
    // ============================================

    let currentBase64Image = null;

    // 1. Handle Image Selection
    function handleImageSelect(input) {
        if (input.files && input.files[0]) {
            const file = input.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                currentBase64Image = e.target.result; // Save Base64
                // Show Preview
                document.getElementById('preview-img-elem').src = currentBase64Image;
                document.getElementById('image-preview').style.display = 'inline-block';
            }
            
            reader.readAsDataURL(file);
        }
    }

    // 2. Clear Image
    function clearImage() {
        currentBase64Image = null;
        document.getElementById('file-upload').value = "";
        document.getElementById('image-preview').style.display = 'none';
    }

    // 3. UPDATED Send Message Function
    async function sendMessage() {
        const text = chatInput.value.trim();
        const modelId = document.getElementById('model-selector').value;

        // Validation: Don't send empty messages unless there is an image
        if (!text && !currentBase64Image) return;

        // GUARD RAIL: Prevent sending images to Chimera
        if (modelId === 'chimera' && currentBase64Image) {
            alert("‚ö†Ô∏è The 'Thinking' model cannot read images.\n\nPlease switch to 'Fast + Vision' or remove the image.");
            return;
        }

        // UI: Clear Inputs immediately
        chatInput.value = '';
        const tempImage = currentBase64Image; // Store for display
        clearImage(); // Clear from state

        // UI: Show User Message (With Image if exists)
        let userDisplayHtml = text;
        if (tempImage) {
            userDisplayHtml += `<br><img src="${tempImage}" style="max-width:100%; border-radius:8px; margin-top:8px;">`;
        }
        addBubble(userDisplayHtml, 'user');

        // UI: Show Typing
        const typingId = showTyping();

        // CONSTRUCT MESSAGE FOR BACKEND
        // Note: We only add the image for the current request context for simplicity in this frontend
        let newMessageObj;

        if (tempImage) {
            newMessageObj = {
                role: "user",
                content: [
                    { type: "text", text: text },
                    { type: "image_url", image_url: { url: tempImage } }
                ]
            };
        } else {
            newMessageObj = { role: "user", content: text };
        }

        // Add to history (We convert object to simple text for history storage to prevent memory bloat in this demo, 
        // but real apps might handle history differently. For now we append the object.)
        // However, standard text-only history might break if we push objects. 
        // For this demo, we push the object, but remember Chimera will fail if it sees previous image objects in history.
        // SIMPLIFICATION: We push the current message to the payload, but might clean history if model switches.
        
        const payloadMessages = [...conversationHistory, newMessageObj];

        try {
            // NOTE: Replace '/api/chat' with your actual backend URL if you have one.
            const response = await fetch('/api/chat', { 
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    messages: payloadMessages,
                    modelId: modelId // Pass the selected model ID
                })
            });

            if (!response.ok) throw new Error("API Error");

            const data = await response.json();
            const aiResponseText = data.choices ? data.choices[0].message.content : data.text; 

            // Add AI response to history
            conversationHistory.push(newMessageObj); // Add user msg to permanent history
            conversationHistory.push({ role: "assistant", content: aiResponseText });

            removeTyping(typingId);
            addBubble(aiResponseText, 'bot');

        } catch (error) {
            console.error("AI Request failed:", error);
            removeTyping(typingId);
            
            // SIMULATED RESPONSE for GitHub Pages
            setTimeout(() => {
                const fallbackResponse = "I have loaded your `context.md` file, but I cannot generate a new answer because there is no backend server connected here on GitHub Pages. \n\nIf you connect this to a Vercel backend, I will be able to answer using the context file!";
                addBubble(fallbackResponse, 'bot');
            }, 500);
        }
    }

    // --- UI HELPERS ---
    function addBubble(text, sender) {
        const div = document.createElement('div');
        const isUser = sender === 'user';
        div.className = `flex ${isUser ? 'justify-end' : 'justify-start'} animate-fade-in-up`;
        
        const bubble = document.createElement('div');
        if (isUser) {
            bubble.className = "bg-indigo-600 text-white rounded-2xl rounded-tr-none px-4 py-2.5 text-sm max-w-[85%] shadow-md break-words";
            // Allow HTML for images
            bubble.innerHTML = text; 
        } else {
            bubble.className = "bg-gray-800 text-gray-200 rounded-2xl rounded-tl-none px-4 py-3 text-sm max-w-[85%] border border-gray-700 shadow-sm break-words";
            // Use 'marked' for markdown if available, else plain text
            bubble.innerHTML = (typeof marked !== 'undefined') ? marked.parse(text) : text;
            
            // Style links inside bubble
            bubble.querySelectorAll('a').forEach(a => {
                a.className = "text-blue-400 hover:text-blue-300 underline";
                a.target = "_blank";
            });
        }
        div.appendChild(bubble);
        messagesContainer.appendChild(div);
        scrollToBottom();
    }

    function showTyping() {
        const id = 'typing-' + Date.now();
        const div = document.createElement('div');
        div.id = id;
        div.className = 'flex justify-start animate-fade-in-up';
        div.innerHTML = `
            <div class="bg-gray-800 rounded-2xl rounded-tl-none px-4 py-3 border border-gray-700 flex items-center space-x-1 w-fit">
                <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style="animation-delay: 0ms"></div>
                <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style="animation-delay: 150ms"></div>
                <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style="animation-delay: 300ms"></div>
            </div>
        `;
        messagesContainer.appendChild(div);
        scrollToBottom();
        return id;
    }

    function removeTyping(id) {
        const el = document.getElementById(id);
        if (el) el.remove();
    }

    function scrollToBottom() {
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    // ------------------------------------------------------------------
    // 3. UTILITIES: Fix Buttons & Copy
    // ------------------------------------------------------------------

    function copyToClipboard(text, btn) {
        navigator.clipboard.writeText(text).then(() => {
            const originalHtml = btn.innerHTML;
            btn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>`;
            setTimeout(() => btn.innerHTML = originalHtml, 2000);
        });
    }

    function toggleFixStatus(id) {
        const card = document.getElementById(id);
        const btn = document.querySelector(`#tracker-${id} button`);
        
        if (card.classList.contains('completed')) {
            card.classList.remove('completed');
            btn.innerText = "Mark as Fixed";
            btn.classList.remove('bg-green-600', 'text-white');
        } else {
            card.classList.add('completed');
            btn.innerText = "Fixed";
            btn.classList.add('bg-green-600', 'text-white');
        }
    }
</script>
</body>
</html>
